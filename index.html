<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QUEST of DUALISM -運命の二択と13の試練-</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div id="app-container">
        <section id="game-area">
            <div class="top-controls">
                <div class="highscore-display">HI-SCORE: <span id="hs-val-sm">B0F</span></div>
                <button class="ctrl-btn" onclick="openHelp()" title="ヘルプ">？</button>
                <button class="ctrl-btn" onclick="openBestiary()" title="図鑑を見る">📖</button>
                <button class="ctrl-btn visual-toggle" onclick="toggleVisualMode()" id="visual-btn" title="画質切替">IMG</button>
                <button class="ctrl-btn auto-btn" onclick="toggleAutoMode()" id="auto-btn">AUTO OFF</button>
                <button class="ctrl-btn sound-toggle" onclick="SoundManager.toggleMute()" title="サウンドON/OFF">🔊</button>
            </div>
            
            <div class="status-container">
                <div class="status-row">
                    <div class="stat-item"><span class="stat-label">FLOOR</span><span class="stat-val floor" id="floor-val">B1F</span></div>
                    <div class="stat-item"><span class="stat-label">LV</span><span class="stat-val" id="level-val">1</span></div>
                    <div class="stat-item"><span class="stat-label">HP</span><span class="stat-val hp" id="hp-val">20</span></div>
                </div>
                <div class="status-row secondary">
                    <div class="stat-item"><span class="stat-label">MP</span><span class="stat-val mp" id="mp-val">5</span></div>
                    <div class="stat-item"><span class="stat-label">こうげき</span><span class="stat-val" id="atk-val">10</span></div>
                    <div class="stat-item" style="margin-left:auto; font-size:0.8rem;"><span class="stat-label">確率:</span> 1/<span id="prob-val">2</span></div>
                </div>
            </div>

            <div id="monster-container">
                <div id="monster-visual">
                    </div>
            </div>

            <div id="message-window">
                モンスターが あらわれた！
            </div>

            <div class="command-window">
                <div class="choices-container">
                    <button class="choice-btn" id="btn-yes" onclick="makeChoice('left')">はい</button>
                    <button class="choice-btn" id="btn-no" onclick="makeChoice('right')">いいえ</button>
                </div>
            </div>
        </section>

        <aside id="sidebar">
            <div class="sidebar-header">ぼうけんの きろく</div>
            <div id="log-container">
                </div>
        </aside>

        <div id="overlay">
            <div class="game-over-title" id="overlay-title">全滅した...</div>
            
            <div id="king-msg" class="king-message"></div>
            
            <div class="result-container">
                <div class="result-header">称号: <span id="alias-val">名もなき村人</span></div>
                
                <div id="new-record-badge" class="new-record">★ NEW RECORD! ★</div>

                <div style="text-align:center; font-size:0.9rem; color:#888; margin-bottom:10px;">
                    正解は「<span id="true-fate-display"></span>」でした
                </div>

                <div class="result-header">最終ステータス</div>
                <div class="result-stats">
                    <span>到達: <span id="res-floor">B1F</span></span>
                    <span>LV: <span id="res-lvl">1</span></span>
                    <span>HP: <span id="res-hp">0</span></span>
                    <span>MP: <span id="res-mp">0</span></span>
                    <span>攻: <span id="res-atk">0</span></span>
                </div>

                <div class="result-header">獲得アイテム</div>
                <div class="loot-list" id="loot-list">
                    </div>
                
                <div class="record-stats-area">
                    <div class="stats-row">
                        <div class="record-stat-box">
                            <span class="record-stat-label">冒険回数</span>
                            <span class="record-stat-num" id="stat-attempts">0</span>
                        </div>
                        <div class="record-stat-box">
                            <span class="record-stat-label">クリア回数</span>
                            <span class="record-stat-num" id="stat-clears">0</span>
                        </div>
                    </div>
                    
                    <div class="stats-row">
                        <div class="record-stat-box">
                            <span class="record-stat-label">総選択数</span>
                            <span class="record-stat-num" id="stat-choices">0</span>
                        </div>
                        <div class="record-stat-box">
                            <span class="record-stat-label">運命的中率</span>
                            <span class="record-stat-num" id="stat-rate">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <button class="restart-btn" onclick="openBestiary()">📖 図鑑を見る</button>
            <button class="restart-btn" onclick="resetGame()">さいしょから</button>
            <br>
            <button class="delete-btn" onclick="clearData()">きろくを まっしょう する</button>
        </div>

        <div id="bestiary-overlay" class="overlay-window">
            <div class="bestiary-header">冒険の書 (図鑑)</div>
            <div class="bestiary-tabs">
                <button class="tab-btn active" onclick="switchBestiaryTab('items')">アイテム</button>
                <button class="tab-btn" onclick="switchBestiaryTab('aliases')">称号</button>
            </div>
            <div style="text-align:right; font-size:0.8rem; margin-bottom:5px; color:#aaa;">
                収集率: <span id="collection-rate">0%</span>
            </div>
            <div id="bestiary-content" class="bestiary-content">
                </div>
            <button class="close-btn" onclick="closeBestiary()">閉じる</button>
        </div>
        
        <div id="help-overlay" class="overlay-window">
            <div class="help-header">あそびかた</div>
            <div class="help-content">
                <div class="help-section">
                    <div class="help-title">ルール</div>
                    <p style="color:#ddd; line-height:1.6;">
                        運命の二択を選び、13の試練を突破せよ。<br>
                        正解ならば先へ進み、強くなる。<br>
                        不正解ならば即死。<br>
                        最深部の魔王を倒すことが目的だ。<br>
                        <span style="color:#aaa; font-size:0.8em;">※低確率で「真の魔王」が現れることもあるらしい…？</span>
                    </p>
                </div>
                <div class="help-section">
                    <div class="help-title">ボタンせつめい</div>
                    <div class="help-item">
                        <div class="help-icon">IMG</div>
                        <div class="help-desc">ドット絵(DOT)と画像モード(IMG)を切り替える。画像がない場合はドット絵が表示される。</div>
                    </div>
                    <div class="help-item">
                        <div class="help-icon">AUTO</div>
                        <div class="help-desc">自動で選択肢を選んで進むモード。ハイスコア到達時や最終戦では自動停止する。</div>
                    </div>
                    <div class="help-item">
                        <div class="help-icon">📖</div>
                        <div class="help-desc">獲得したアイテムや称号の図鑑を見る。</div>
                    </div>
                    <div class="help-item">
                        <div class="help-icon">🔊</div>
                        <div class="help-desc">サウンドのON/OFFを切り替える。</div>
                    </div>
                </div>
            </div>
            <button class="close-btn" onclick="closeHelp()">閉じる</button>
        </div>
    </div>

    <script src="js/script.js"></script>
</body>
</html>
